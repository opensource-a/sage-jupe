import boto3
import time, re 

query = "select * from input;"
database = "test"
athena_result_bucket = "s3://20210215-athena/output/"
client = boto3.client('athena')
response = client.start_query_execution(
    QueryString=query,
    QueryExecutionContext={
        'Database': database
    },
    ResultConfiguration={
        'OutputLocation': athena_result_bucket,
    }
)

query_execution_id = response["QueryExecutionId"]
print(query_execution_id)







while (state in ['RUNNING', 'QUEUED']):
    response = client.get_query_execution(QueryExecutionId = query_execution_id)
    state = response['QueryExecution']['Status']['State']
    print(state)
    time.sleep(5)
if state == 'FAILED':
    print("Query execution failed")
    exit(1)
elif state == 'SUCCEEDED':
    s3_path = response['QueryExecution']['ResultConfiguration']['OutputLocation']
    filename = re.findall('.*\/(.*)', s3_path)[0]
    print(filename)
